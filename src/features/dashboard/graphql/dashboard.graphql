# ============================================
# Dashboard GraphQL Queries
# Replaces React Query with GraphQL/Apollo
# ============================================

# ============================================
# FRAGMENTS
# ============================================

fragment ProfileBasicInfo on profiles {
  id
  email
  full_name
  username
  weight
  height
  target_weight
  age
  gender
  activity_level
  goal
  dietary_preferences
  created_at
  updated_at
}

fragment QuizResultInfo on quiz_results {
  id
  user_id
  answers
  calculations
  created_at
  updated_at
}

fragment MealPlanInfo on ai_meal_plans {
  id
  user_id
  plan_data
  meals
  macros
  created_at
  updated_at
}

fragment WorkoutPlanInfo on ai_workout_plans {
  id
  user_id
  plan_data
  workouts
  created_at
  updated_at
}

fragment WaterIntakeInfo on daily_water_intake {
  id
  user_id
  log_date
  glasses
  total_ml
  created_at
  updated_at
}

# ============================================
# QUERIES
# ============================================

# Get complete dashboard overview
query GetDashboardOverview($userId: UUID!) {
  profilesCollection(filter: { id: { eq: $userId } }) {
    edges {
      node {
        ...ProfileBasicInfo
      }
    }
  }

  quiz_resultsCollection(
    filter: { user_id: { eq: $userId } }
    orderBy: [{ created_at: DescNullsLast }]
    first: 1
  ) {
    edges {
      node {
        ...QuizResultInfo
      }
    }
  }
}

# Get nutrition data (meal plans and water intake)
query GetNutritionData($userId: UUID!, $date: Date!) {
  ai_meal_plansCollection(
    filter: { user_id: { eq: $userId } }
    orderBy: [{ created_at: DescNullsLast }]
    first: 1
  ) {
    edges {
      node {
        ...MealPlanInfo
      }
    }
  }

  daily_water_intakeCollection(
    filter: {
      user_id: { eq: $userId }
      log_date: { eq: $date }
    }
  ) {
    edges {
      node {
        ...WaterIntakeInfo
      }
    }
  }

  meal_logsCollection(
    filter: {
      user_id: { eq: $userId }
      logged_at: { gte: $date }
    }
    orderBy: [{ logged_at: DescNullsLast }]
  ) {
    edges {
      node {
        id
        user_id
        meal_name
        calories
        protein_g
        carbs_g
        fat_g
        logged_at
      }
    }
  }
}

# Get workout data
query GetWorkoutData($userId: UUID!) {
  ai_workout_plansCollection(
    filter: { user_id: { eq: $userId } }
    orderBy: [{ created_at: DescNullsLast }]
    first: 1
  ) {
    edges {
      node {
        ...WorkoutPlanInfo
      }
    }
  }

  workout_logsCollection(
    filter: { user_id: { eq: $userId } }
    orderBy: [{ completed_at: DescNullsLast }]
    first: 10
  ) {
    edges {
      node {
        id
        user_id
        workout_name
        duration_minutes
        calories_burned
        completed_at
      }
    }
  }
}

# Get progress data (weight history, measurements)
query GetProgressData($userId: UUID!) {
  profilesCollection(filter: { id: { eq: $userId } }) {
    edges {
      node {
        ...ProfileBasicInfo
      }
    }
  }

  # This would need a weight_logs table - placeholder for now
  # weight_logsCollection(
  #   filter: { user_id: { eq: $userId } }
  #   orderBy: [{ logged_at: DescNullsLast }]
  #   first: 30
  # ) {
  #   edges {
  #     node {
  #       id
  #       weight
  #       logged_at
  #     }
  #   }
  # }
}

# ============================================
# MUTATIONS
# ============================================

# Log water intake
mutation LogWaterIntake(
  $userId: UUID!
  $logDate: Date!
  $glasses: Int!
  $totalMl: Int!
) {
  insertIntodaily_water_intakeCollection(
    objects: [{
      user_id: $userId
      log_date: $logDate
      glasses: $glasses
      total_ml: $totalMl
    }]
  ) {
    affectedCount
    records {
      ...WaterIntakeInfo
    }
  }
}

# Update water intake (upsert)
mutation UpdateWaterIntake(
  $userId: UUID!
  $logDate: Date!
  $glasses: Int!
  $totalMl: Int!
) {
  updatedaily_water_intakeCollection(
    filter: {
      user_id: { eq: $userId }
      log_date: { eq: $logDate }
    }
    set: {
      glasses: $glasses
      total_ml: $totalMl
    }
  ) {
    affectedCount
    records {
      ...WaterIntakeInfo
    }
  }
}

# Log meal
mutation LogMeal(
  $userId: UUID!
  $mealName: String!
  $calories: Int!
  $proteinG: Float!
  $carbsG: Float!
  $fatG: Float!
) {
  insertIntomeal_logsCollection(
    objects: [{
      user_id: $userId
      meal_name: $mealName
      calories: $calories
      protein_g: $proteinG
      carbs_g: $carbsG
      fat_g: $fatG
      logged_at: "now()"
    }]
  ) {
    affectedCount
    records {
      id
      meal_name
      calories
    }
  }
}

# Log workout
mutation LogWorkout(
  $userId: UUID!
  $workoutName: String!
  $durationMinutes: Int!
  $caloriesBurned: Int!
) {
  insertIntoworkout_logsCollection(
    objects: [{
      user_id: $userId
      workout_name: $workoutName
      duration_minutes: $durationMinutes
      calories_burned: $caloriesBurned
      completed_at: "now()"
    }]
  ) {
    affectedCount
    records {
      id
      workout_name
      duration_minutes
    }
  }
}
