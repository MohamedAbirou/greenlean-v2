# Rewards Catalog Queries

query GetRewardsCatalog {
  rewards_catalogCollection(
    filter: { is_active: { eq: true } }
    orderBy: [{ points_cost: AscNullsLast }]
  ) {
    edges {
      node {
        id
        name
        description
        type
        points_cost
        tier_requirement
        stock_quantity
        image_url
        metadata
        created_at
      }
    }
  }
}

query GetUserRewards($userId: UUID!) {
  user_rewardsCollection(filter: { user_id: { eq: $userId } }) {
    edges {
      node {
        user_id
        points
        lifetime_points
        badges
        updated_at
      }
    }
  }
}

query GetUserRedemptions($userId: UUID!) {
  user_reward_redemptionsCollection(
    filter: { user_id: { eq: $userId } }
    orderBy: [{ redeemed_at: DescNullsLast }]
  ) {
    edges {
      node {
        id
        reward_id
        points_spent
        status
        redemption_data
        redeemed_at
        fulfilled_at
        expires_at
      }
    }
  }
}

# Mutations

mutation RedeemReward($userId: UUID!, $rewardId: UUID!, $pointsSpent: Int!) {
  insertIntouser_reward_redemptionsCollection(
    objects: [{
      user_id: $userId
      reward_id: $rewardId
      points_spent: $pointsSpent
      status: "pending"
    }]
  ) {
    affectedCount
    records {
      id
      status
      redeemed_at
    }
  }
}

mutation UpdateUserPoints($userId: UUID!, $newPoints: Int!) {
  updateuser_rewardsCollection(
    filter: { user_id: { eq: $userId } }
    set: { points: $newPoints }
  ) {
    affectedCount
    records {
      points
      lifetime_points
    }
  }
}
