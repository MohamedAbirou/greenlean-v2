# =============================================
# CHALLENGES & GAMIFICATION QUERIES
# =============================================

# Query: Get all challenges with user participation data
query GetChallenges($userId: UUID) {
  challengesCollection(filter: { is_active: { eq: true } }) {
    edges {
      node {
        id
        title
        description
        type
        difficulty
        points
        badge_id
        requirements
        start_date
        end_date
        is_active
        created_at
        updated_at
      }
    }
  }
  challenge_participantsCollection(filter: { user_id: { eq: $userId } }) {
    edges {
      node {
        id
        challenge_id
        user_id
        progress
        completed
        completion_date
        streak_count
        last_progress_date
        streak_expires_at
        streak_warning_sent
        created_at
      }
    }
  }
}

# Query: Get user rewards (points and badges)
query GetUserRewards($userId: UUID!) {
  user_rewardsCollection(filter: { user_id: { eq: $userId } }) {
    edges {
      node {
        user_id
        points
        lifetime_points
        badges
        created_at
        updated_at
      }
    }
  }
}

# Query: Get all badges
query GetBadges {
  badgesCollection {
    edges {
      node {
        id
        name
        description
        icon
        color
        requirement_type
        requirement_value
        created_at
      }
    }
  }
}

# Query: Get user's earned badges
query GetUserBadges($userId: UUID!) {
  user_badgesCollection(filter: { user_id: { eq: $userId } }) {
    edges {
      node {
        id
        user_id
        badge_id
        earned_at
        created_at
      }
    }
  }
}

# Query: Get rewards catalog
query GetRewardsCatalog($filter: rewards_catalogFilter) {
  rewards_catalogCollection(
    filter: $filter
    orderBy: [{ cost_points: AscNullsLast }]
  ) {
    edges {
      node {
        id
        name
        description
        cost_points
        type
        value
        tier_requirement
        stock_quantity
        is_active
        icon
        image_url
        metadata
        created_at
        updated_at
      }
    }
  }
}

# Query: Get user's redeemed rewards
query GetUserRedeemedRewards($userId: UUID!) {
  user_redeemed_rewardsCollection(filter: { user_id: { eq: $userId } }) {
    edges {
      node {
        id
        user_id
        reward_id
        type
        reward_value
        points_spent
        redeemed_at
        used
        used_at
        created_at
      }
    }
  }
}

# Query: Get specific challenge with details
query GetChallengeDetails($challengeId: UUID!) {
  challengesCollection(filter: { id: { eq: $challengeId } }) {
    edges {
      node {
        id
        title
        description
        type
        difficulty
        points
        badge_id
        requirements
        start_date
        end_date
        is_active
        created_at
        updated_at
      }
    }
  }
  challenge_participantsCollection(filter: { challenge_id: { eq: $challengeId } }) {
    edges {
      node {
        id
        challenge_id
        user_id
        progress
        completed
        completion_date
        streak_count
        last_progress_date
        streak_expires_at
        created_at
      }
    }
  }
}

# =============================================
# MUTATIONS
# =============================================

# Mutation: Join a challenge
mutation JoinChallenge($challengeId: UUID!, $userId: UUID!) {
  insertIntochallenge_participantsCollection(
    objects: [
      {
        challenge_id: $challengeId
        user_id: $userId
        progress: { current: 0 }
        completed: false
        streak_count: 0
      }
    ]
  ) {
    records {
      id
      challenge_id
      user_id
      progress
      completed
      streak_count
      created_at
    }
    affectedCount
  }
}

# Mutation: Quit a challenge
mutation QuitChallenge($challengeId: UUID!, $userId: UUID!) {
  deleteFromchallenge_participantsCollection(
    filter: { challenge_id: { eq: $challengeId }, user_id: { eq: $userId } }
  ) {
    records {
      id
      challenge_id
      user_id
    }
    affectedCount
  }
}

# Mutation: Update challenge progress
mutation UpdateChallengeProgress(
  $challengeId: UUID!
  $userId: UUID!
  $progress: JSON!
  $completed: Boolean!
  $completionDate: Datetime
  $streakCount: Int
  $lastProgressDate: Datetime
  $streakExpiresAt: Datetime
) {
  updatechallenge_participantsCollection(
    filter: { challenge_id: { eq: $challengeId }, user_id: { eq: $userId } }
    set: {
      progress: $progress
      completed: $completed
      completion_date: $completionDate
      streak_count: $streakCount
      last_progress_date: $lastProgressDate
      streak_expires_at: $streakExpiresAt
    }
  ) {
    records {
      id
      challenge_id
      user_id
      progress
      completed
      completion_date
      streak_count
      last_progress_date
      streak_expires_at
    }
    affectedCount
  }
}

# Mutation: Redeem a reward
mutation RedeemReward(
  $userId: UUID!
  $rewardId: UUID!
  $rewardType: String!
  $rewardValue: String!
  $pointsSpent: Int!
) {
  insertIntouser_redeemed_rewardsCollection(
    objects: [
      {
        user_id: $userId
        reward_id: $rewardId
        type: $rewardType
        reward_value: $rewardValue
        points_spent: $pointsSpent
      }
    ]
  ) {
    records {
      id
      user_id
      reward_id
      type
      reward_value
      points_spent
      redeemed_at
      used
      created_at
    }
    affectedCount
  }
}
